<%- include('partials/header', { title: "Market | Connieâ€™s Trinkets", loggedIn: loggedIn }) %>

<section class="market">
  <h1>Items</h1>
  <p>Choose an item to claim or view details.</p>

  <form class="market-filters" method="GET" action="/market">
    <div class="search-box">
      <label for="q">Search:</label>
      <input
        type="text"
        id="q"
        name="q"
        placeholder="Search name or description"
        value="<%= q || '' %>"
      />
      <button type="submit" class="button small">Search</button>
      <a href="/market" class="button small">Clear</a>
    </div>

    <fieldset class="category-filters">
      <legend>Categories</legend>

      <% if (categories && categories.length > 0) { %>
        <% categories.forEach(cat => { %>
          <label class="checkbox-inline">
            <input
              type="checkbox"
              name="categories"
              value="<%= cat %>"
              <%= (selectedCategories || []).includes(cat) ? 'checked' : '' %>
            />
            <%= cat %>
          </label>
        <% }) %>
      <% } %>
    </fieldset>
  </form>

  <div class="item-grid">
    <% if (items && items.length > 0) { %>
      <% items.forEach(item => { %>
        <div class="item-card <%= item.claimedBy ? 'claimed-item' : '' %>">
          <img
            src="<%= item.image || '/images/default.jpg' %>"
            alt="<%= item.itemName %>"
          />

          <h3><%= item.itemName %></h3>
          <p><%= item.itemDesc %></p>

          <p class="claimed-status">
            <% if (item.claimedBy) { %>
              <span class="claimed">
                Claimed by <%= item.claimedBy %>
              </span>
            <% } else { %>
              <form action="/claim/<%= item.id %>" method="POST">
                <button type="submit" class="button small">
                  Claim Item
                </button>
              </form>
            <% } %>
          </p>
        </div>
      <% }) %>
    <% } else { %>
      <p class="no-items">No items found.</p>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>
