<%- include('partials/header', { title: "My Account | Connie’s Trinkets", loggedIn: loggedIn }) %>

<main class="edit-item-page"> 
  <div class="form-card edit-card" style="max-width: 700px; width: 100%;">

    <h2 class="account-title" style="text-align:center;">
      Welcome, <%= user.userFirstName %> <%= user.userLastName %>
    </h2>

    <!-- Claimed Items Section -->
    <section class="form-group" style="margin-top: 1.5rem;">
      <h3>Your Claimed Items</h3>

      <% if (items.length > 0) { %>
        <ul class="claimed-items">
          <% items.forEach(i => { %>
            <li class="claimed-item">
              
              <div class="item-details">
                <strong><%= i.itemName %></strong>
                <p><%= i.itemDesc %></p>
              </div>

              <form action="/unclaim/<%= i.itemID %>" method="POST" class="unclaim-form">
                <button type="submit" class="btn btn-danger small">Unclaim</button>
              </form>

            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p class="no-items" style="margin-top: 1rem;">You haven’t claimed any items yet.</p>
      <% } %>

      <a href="/market" class="btn btn-secondary full-width" style="margin-top:1rem;">Go to Market</a>
    </section>

    <% if (user.role === 'M') { %>
    <!-- Manager Section -->
    <section class="form-group" style="margin-top: 2rem;">
      <h3>Manager — Edit User</h3>

      <form action="/user/update" method="POST" class="manager-form">

        <div class="form-group">
          <label>Select User</label>
          <select name="username">
            <% users.forEach(u => { %>
              <option value="<%= u.username %>">
                <%= u.username %> — <%= u.userFirstName %> <%= u.userLastName %> (<%= u.role %>)
              </option>
            <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label>First Name</label>
          <input name="userFirstName" placeholder="New first name" />
        </div>

        <div class="form-group">
          <label>Last Name</label>
          <input name="userLastName" placeholder="New last name" />
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" name="password" placeholder="Leave blank to keep current" />
        </div>

        <div class="form-group">
          <label>Role</label>
          <select name="role">
            <option value="U">User</option>
            <option value="M">Manager</option>
          </select>
        </div>

        <button type="submit" class="btn full-width">Update User</button>
        <button formaction="/user/delete" class="btn btn-danger full-width" style="margin-top: 0.5rem;">
          Delete User
        </button>

      </form>
    </section>
    <% } %>

  </div>
</main>

<%- include('partials/footer') %>