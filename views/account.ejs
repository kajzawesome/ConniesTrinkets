<%- include('partials/header', { title: "My Account | Connie’s Trinkets", loggedIn: loggedIn }) %>

<main class="account-section">

  <h1 class="account-title">Welcome, <%= user %></h1>

  <!-- Claimed Items Section -->
  <section class="account-card">
    <h2>Your Claimed Items</h2>

    <% if (items.length > 0) { %>
      <ul class="claimed-items">
        <% items.forEach(i => { %>
          <li class="card-item account-item">
            <div class="item-details">
              <strong><%= i.itemName %></strong>
              <p><%= i.itemDesc %></p>
            </div>

            <form action="/unclaim/<%= i.itemID %>" method="POST" class="unclaim-form">
              <button type="submit" class="btn btn-danger">Unclaim</button>
            </form>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p class="no-items">You haven’t claimed any items yet.</p>
    <% } %>

    <a href="/market" class="btn btn-secondary">Go to Market</a>
  </section>

  <% if (role === 'M') { %>
  <!-- Manager Section -->
  <section class="account-card manager-card">
    <h2>Manager — Edit User</h2>

    <form action="/user/update" method="POST" class="manager-form">
      <div class="form-group">
        <label>Select User</label>
        <select name="username">
          <% users.forEach(u => { %>
            <option value="<%= u.username %>">
              <%= u.username %> — <%= u.userFirstName %> <%= u.userLastName %> (<%= u.role %>)
            </option>
          <% }) %>
        </select>
      </div>

      <div class="form-group">
        <label>First Name</label>
        <input name="userFirstName" placeholder="New first name" />
      </div>

      <div class="form-group">
        <label>Last Name</label>
        <input name="userLastName" placeholder="New last name" />
      </div>

      <div class="form-group">
        <label>Password</label>
        <input name="password" type="password" placeholder="Leave blank to keep current" />
      </div>

      <div class="form-group">
        <label>Role</label>
        <select name="role">
          <option value="U">User</option>
          <option value="M">Manager</option>
        </select>
      </div>

      <button type="submit" class="btn">Update User</button>
    </form>
  </section>
  <% } %>

</main>

<%- include('partials/footer') %>